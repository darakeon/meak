@using Presentation.Models.General
@using Structure.Helpers
@model Presentation.Models.SeasonEditEpisodeModel

@{
	ViewBag.Title = String.Format("MEAK {0}{1} – {2}", Model.Story.Season, Model.Story, Model.Story.Title);
	Layout = "~/Views/Shared/_Layout.cshtml";

	var route = new { episodeID = Model.Story.ID, seasonID = Model.Story.Season.ID };
	var formId = "form_title";
	
	var html = new { id = formId };

	var ajaxOptions = new AjaxOptions
	{ 
		HttpMethod = "Post", 
		OnBegin = "SaveBegin('" + formId + "')", 
		OnSuccess = "SaveSuccess('" + formId + "')", 
		OnFailure = "SaveFailure('" + formId + "')"
	};

	var topSelector =
		new TopSelectorModel
		{
			Total = Model.Story.BlockList.Count,
			Current = Convert.ToInt32(Model.ReadingBlock[0]) - 97
		};
}

<script src="@Url.Content("~/Assets/js/Author/Inputs.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Assets/js/Author/Suggestion.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Assets/js/Author/Adder.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Assets/js/Author/SaveChangeColor.js")" type="text/javascript"></script>

<script src="@Url.Content("~/Assets/js/Author/General.js")" type="text/javascript"></script>

@Html.Partial("Suggestion")

@section Header
{
	<div class="absolute-header lightback">
		@using (Ajax.BeginForm("EditTitle", route, ajaxOptions, html))
		{
			var paragraphsCount = Model.Story.BlockList.Sum(s => s.ParagraphCount);

			<div class="titleChange">
				<button type="submit" class="darkback save">Save</button>

				@Html.ActionLink("Upload",
					"Upload", "Upload",
					RouteStories.With(Model.Story.Season.ID, Model.Story.ID, "_"),
					new { @class = "darkback save", target = "_blank" })

				@Html.TextBoxFor(m => m.Story.Title)

				<span class="paragraphCountTitle">
					Paragraphs last count: @paragraphsCount
				</span>
				
				<br/>

				@Html.TextAreaFor(m => m.Story.Summary)
			</div>
		}
	</div>
}


@Html.Partial("Partial/ChangeBlock", topSelector)

<div class="blocks">
	@for (var s = 0; s < Model.Story.BlockList.Count; s++)
	{
		Model.BlockCounter = s;

		@Html.Partial("Author/Block")
	}
</div>

@Html.Partial("Partial/ChangeBlock", topSelector)

@Html.Partial("Partial/Sign")